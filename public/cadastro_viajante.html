
<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cadastro de Viajante - Sua Viagem Aqui</title>
    <link rel="manifest" href="/manifest.json" />
    <link rel="stylesheet" href="/css/styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>
  <body class="bg-slate-900 flex flex-col min-h-screen">
    <header id="main-header" class="bg-slate-900/80 backdrop-blur-lg shadow-lg sticky top-0 z-50 border-b border-slate-700">
      <!-- O cabeçalho será carregado aqui -->
    </header>
    <main class="flex-grow container mx-auto px-4 py-16 flex items-center justify-center">
      <div class="max-w-md w-full">
        <div class="text-center mb-10">
          <h1 class="text-4xl md:text-5xl font-bold text-white mb-4">
            Crie sua Conta
          </h1>
          <p class="text-lg text-slate-400">
            Junte-se à nossa comunidade de viajantes.
          </p>
        </div>
        <form id="register-form" class="glass-effect rounded-3xl p-8 md:p-10 shadow-2xl space-y-6">
          <div>
            <label for="name" class="block text-white text-sm font-semibold mb-3"><i class="fas fa-user mr-2"></i>Nome Completo</label>
            <input type="text" id="name" name="name" required placeholder="Seu nome" class="form-input"/>
          </div>
          <div>
            <label for="email" class="block text-white text-sm font-semibold mb-3"><i class="fas fa-envelope mr-2"></i>E-mail</label>
            <input type="email" id="email" name="email" required placeholder="seu@email.com" autocomplete="email" class="form-input"/>
          </div>
          <div>
            <label for="password" class="block text-white text-sm font-semibold mb-3"><i class="fas fa-lock mr-2"></i>Senha</label>
            <input type="password" id="password" name="password" required minlength="6" placeholder="Mínimo 6 caracteres" class="form-input"/>
          </div>
          <div>
            <label for="confirm-password" class="block text-white text-sm font-semibold mb-3"><i class="fas fa-lock mr-2"></i>Confirme a Senha</label>
            <input type="password" id="confirm-password" name="confirm-password"--- START OF FILE public/src/cadastro_viajante.js ---

import {
  auth,
  db,
  doc,
  setDoc,
  serverTimestamp,
  httpsCallable,
  functions,
  createUserWithEmailAndPassword,
} from "./firebase.js";
import { showAlert } from "./ui/alert.js";
import { initApp } from "./app.js";
import { setupRealtimeEmailCheck } from "./form-utils.js";

document.addEventListener("DOMContentLoaded", () => {
    initApp();

    const registerForm = document.getElementById("register-form");
    if (!registerForm) return;

    setupRealtimeEmailCheck("email");

    const submitBtn = document.getElementById("submit-btn");
    const submitText = submitBtn.querySelector(".submit-text");
    const submitLoading = submitBtn.querySelector(".submit-loading");

    registerForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        
        const password = registerForm.password.value;
        const confirmPassword = registerForm["confirm-password"].value;

        if (password !== confirmPassword) {
            showAlert("As senhas não coincidem.");
            return;
        }

        submitText.classList.add("hidden");
        submitLoading.classList.remove("hidden");
        submitLoading.classList.add("flex");
        submitBtn.disabled = true;

        const name = registerForm.name.value;
        const email = registerForm.email.value;

        try {
            const userCredential = await createUserWithEmailAndPassword(auth, email, password);
            const user = userCredential.user;

            const generateCode = httpsCallable(functions, "generateAndAssignControlCode");
            await generateCode({ userId: user.uid, userType: 'vj' });

            await setDoc(doc(db, "users", user.uid), {
                uid: user.uid,
                name: name,
                email: email,
                role: "traveler",
                payment_status: "free",
                createdAt: serverTimestamp(),
            });

            // Redireciona para o perfil após o sucesso
            window.location.assign("/perfil.html");

        } catch (error) {
            console.error("Erro no cadastro:", error);
            let friendlyMessage = "Ocorreu um erro ao criar a conta. Tente novamente.";
            if (error.code === "auth/email-already-in-use") {
                friendlyMessage = "Este e-mail já está em uso. Tente fazer login ou use outro e-mail.";
            } else if (error.code === "auth/weak-password") {
                friendlyMessage = "A senha deve ter pelo menos 6 caracteres.";
            }
            showAlert(friendlyMessage);
        } finally {
            submitText.classList.remove("hidden");
            submitLoading.classList.add("hidden");
            submitLoading.classList.remove("flex");
            submitBtn.disabled = false;
        }
    });
});